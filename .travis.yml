language: go

go:
  - 1.11.x
  - tip

addons:
  mariadb: '10.1'

sudo: false

env:
  - GO111MODULE=on

install:
  - go get ./...
  - go install github.com/mattn/go-sqlite3

before_script:
  - mysql -e 'CREATE DATABASE bartlett;'

script:
  - go test -coverprofile=coverage-unit.txt -v $(go list ./... | grep -v mariadb | grep -v sqlite3)
  - go test -coverprofile=coverage-sqlite3.txt -v ./sqlite3
  - go test -coverprofile=coverage-mariadb.txt -v ./mariadb -dsn travis@/bartlett
  - cat coverage-mariadb.txt coverage-sqlite3.txt | grep -v "mode:" | cat coverage-unit.txt - > coverage.txt

after_success:
  - bash <(curl -s https://codecov.io/bash)
